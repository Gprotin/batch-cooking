<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Batch Cooking</title>
    <style>
        :root { --primary: #10b981; --bg: #f3f4f6; --card: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: #333; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; color: #064e3b; font-size: 1.5rem; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem;}
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-group div { flex: 1; }
        input { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;}
        button { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 1rem; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; }
        .hidden { display: none; }
        .recipe-details { font-size: 0.85rem; color: #666; margin-top: 5px; list-style-type: circle; padding-left: 15px; }
        ul { padding-left: 20px; }
        li { margin-bottom: 10px; }
        a { color: var(--primary); text-decoration: none; font-weight: 500; }
    </style>
</head>
<body>

<div class="container">
    <h1>ü•ó Batch Cooking & Diet</h1>
    
    <div class="card">
        <h3>1. Ma Famille</h3>
        <div class="input-group">
            <div>
                <label>Adultes</label>
                <input type="number" id="nbAdults" value="2" min="1">
            </div>
            <div>
                <label>Enfants</label>
                <input type="number" id="nbKids" value="2" min="0">
            </div>
        </div>
        <label>Jours de menus :</label>
        <input type="number" id="daysCount" value="5" min="1" max="7">
        <button onclick="generateMenu()">G√©n√©rer ma semaine</button>
    </div>

    <div id="resultArea" class="hidden">
        <div class="card">
            <h3>üìÖ Menu & Recettes</h3>
            <div id="menuOutput"></div>
        </div>
        <div class="card">
            <h3>üõí Liste de courses (Global)</h3>
            <div id="shoppingListOutput"></div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="exportToNotes()">üì§ Exporter vers Notes</button>
        </div>
    </div>
</div>

<script>
    const recipesDB = [
  { "id": 1, "nom": "Bolognaise de B≈ìuf 5% (L√©gumes cach√©s)", "tags": ["boeuf", "tomate", "pates"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Boeuf hach√© 5%", "quantite": 500, "unite": "g"}, {"nom": "Spaghetti complets", "quantite": 400, "unite": "g"}, {"nom": "Carottes", "quantite": 3, "unite": "pi√®ces"}, {"nom": "Coulis de tomate", "quantite": 500, "unite": "ml"}] },
  { "id": 2, "nom": "Dahl de Lentilles Corail", "tags": ["vege", "coco", "riz"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Lentilles corail", "quantite": 300, "unite": "g"}, {"nom": "Lait de coco light", "quantite": 400, "unite": "ml"}, {"nom": "Riz basmati", "quantite": 250, "unite": "g"}] },
  { "id": 3, "nom": "Frittata Brocolis & Pommes de terre", "tags": ["oeuf", "vert", "pdt"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Oeufs", "quantite": 8, "unite": "pi√®ces"}, {"nom": "Pommes de terre", "quantite": 500, "unite": "g"}, {"nom": "Brocolis", "quantite": 1, "unite": "t√™te"}] },
  { "id": 4, "nom": "Lasagnes √† la Bolognaise et Carottes", "tags": ["boeuf", "tomate", "pates"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Boeuf hach√© 5%", "quantite": 500, "unite": "g"}, {"nom": "P√¢tes √† lasagnes", "quantite": 250, "unite": "g"}, {"nom": "Carottes", "quantite": 4, "unite": "pi√®ces"}, {"nom": "Coulis de tomate", "quantite": 600, "unite": "ml"}, {"nom": "B√©chamel l√©g√®re", "quantite": 400, "unite": "ml"}] },
  { "id": 5, "nom": "Boulettes de Boeuf au Fromage et Tomate", "tags": ["boeuf", "tomate", "riz"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Boeuf hach√© 5%", "quantite": 600, "unite": "g"}, {"nom": "Mozzarella r√¢p√©e", "quantite": 100, "unite": "g"}, {"nom": "Pur√©e de tomate", "quantite": 400, "unite": "ml"}, {"nom": "Riz complet", "quantite": 250, "unite": "g"}] },
  { "id": 6, "nom": "Gratin de P√¢tes au Jambon de Boeuf", "tags": ["boeuf", "creme", "pates"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "P√¢tes compl√®tes", "quantite": 400, "unite": "g"}, {"nom": "D√©s de jambon de boeuf", "quantite": 200, "unite": "g"}, {"nom": "Brocolis", "quantite": 600, "unite": "g"}, {"nom": "Cr√®me l√©g√®re 12%", "quantite": 200, "unite": "ml"}] },
  { "id": 7, "nom": "Hachis Parmentier Doux", "tags": ["boeuf", "terroir", "pdt"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Boeuf hach√© 5%", "quantite": 500, "unite": "g"}, {"nom": "Pommes de terre", "quantite": 800, "unite": "g"}, {"nom": "Petits pois", "quantite": 200, "unite": "g"}, {"nom": "Lait", "quantite": 150, "unite": "ml"}] },
  { "id": 8, "nom": "Riz Cantonais au Boeuf hach√©", "tags": ["boeuf", "asie", "riz"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Riz basmati", "quantite": 250, "unite": "g"}, {"nom": "Oeufs", "quantite": 4, "unite": "pi√®ces"}, {"nom": "Petits pois", "quantite": 150, "unite": "g"}, {"nom": "Boeuf hach√©", "quantite": 400, "unite": "g"}] },
  { "id": 9, "nom": "Lentilles Saucisses de Boeuf Express", "tags": ["boeuf", "terroir", "legumineuse"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Lentilles vertes", "quantite": 300, "unite": "g"}, {"nom": "Saucisses de boeuf", "quantite": 4, "unite": "pi√®ces"}, {"nom": "Carottes", "quantite": 3, "unite": "pi√®ces"}] },
  { "id": 10, "nom": "Quiche sans P√¢te Poireaux et Bacon Boeuf", "tags": ["oeuf", "vert", "leger"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Oeufs", "quantite": 5, "unite": "pi√®ces"}, {"nom": "Poireaux", "quantite": 3, "unite": "pi√®ces"}, {"nom": "Bacon de boeuf", "quantite": 100, "unite": "g"}, {"nom": "Farine", "quantite": 80, "unite": "g"}] },
  { "id": 11, "nom": "Moussaka L√©g√®re au Boeuf", "tags": ["boeuf", "tomate", "aubergine"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Boeuf hach√© 5%", "quantite": 500, "unite": "g"}, {"nom": "Aubergines", "quantite": 3, "unite": "pi√®ces"}, {"nom": "Tomates concass√©es", "quantite": 400, "unite": "g"}] },
  { "id": 12, "nom": "Filet Mignon de Porc aux Pommes", "tags": ["porc", "sucre-sale", "pdt"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Filet mignon", "quantite": 600, "unite": "g"}, {"nom": "Pommes", "quantite": 3, "unite": "pi√®ces"}, {"nom": "Pommes de terre", "quantite": 400, "unite": "g"}] },
  { "id": 13, "nom": "Curry de Pois Chiches au Lait de Coco", "tags": ["vege", "coco", "quinoa"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Pois chiches cuits", "quantite": 500, "unite": "g"}, {"nom": "Lait de coco light", "quantite": 400, "unite": "ml"}, {"nom": "Quinoa", "quantite": 200, "unite": "g"}] },
  { "id": 14, "nom": "P√¢tes √† la Cr√®me de Potiron", "tags": ["vege", "creme", "pates"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "P√¢tes compl√®tes", "quantite": 400, "unite": "g"}, {"nom": "Pur√©e de potiron", "quantite": 400, "unite": "g"}, {"nom": "Parmesan", "quantite": 50, "unite": "g"}] },
  { "id": 15, "nom": "Muffins aux Oeufs et Courgettes", "tags": ["oeuf", "vert", "leger"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Oeufs", "quantite": 8, "unite": "pi√®ces"}, {"nom": "Courgettes", "quantite": 2, "unite": "pi√®ces"}, {"nom": "Pain complet", "quantite": 4, "unite": "tranches"}] },
  { "id": 16, "nom": "Tacos au Boeuf et Ma√Øs", "tags": ["boeuf", "mexique", "tortilla"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Tortillas bl√© complet", "quantite": 8, "unite": "pi√®ces"}, {"nom": "Boeuf hach√©", "quantite": 400, "unite": "g"}, {"nom": "Ma√Øs", "quantite": 150, "unite": "g"}] },
  { "id": 17, "nom": "Risotto aux Champignons et Porc", "tags": ["porc", "creme", "riz"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Riz arborio", "quantite": 300, "unite": "g"}, {"nom": "Champignons", "quantite": 400, "unite": "g"}, {"nom": "D√©s de porc", "quantite": 400, "unite": "g"}] },
  { "id": 18, "nom": "Omelette Roul√©e au Fromage Frais", "tags": ["oeuf", "froid", "pdt"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Oeufs", "quantite": 10, "unite": "pi√®ces"}, {"nom": "Fromage frais", "quantite": 150, "unite": "g"}, {"nom": "Pommes de terre", "quantite": 400, "unite": "g"}] },
  { "id": 19, "nom": "Boulettes de Lentilles Tomat√©es", "tags": ["vege", "tomate", "pates"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Lentilles cuites", "quantite": 400, "unite": "g"}, {"nom": "Coulis de tomate", "quantite": 400, "unite": "ml"}, {"nom": "Spaghetti", "quantite": 300, "unite": "g"}] },
  { "id": 20, "nom": "Gratin de Chou-fleur au Jambon de Boeuf", "tags": ["boeuf", "vert", "gratine"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Chou-fleur", "quantite": 1, "unite": "pi√®ce"}, {"nom": "D√©s de jambon de boeuf", "quantite": 200, "unite": "g"}, {"nom": "Lait", "quantite": 400, "unite": "ml"}] },
  { "id": 21, "nom": "Chili Sin Carne (V√©g√©tarien)", "tags": ["vege", "mexique", "riz"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Haricots rouges", "quantite": 500, "unite": "g"}, {"nom": "Riz complet", "quantite": 250, "unite": "g"}, {"nom": "Pulpe de tomate", "quantite": 400, "unite": "ml"}] },
  { "id": 22, "nom": "Fajitas au Boeuf et Poivrons", "tags": ["boeuf", "mexique", "tortilla"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Boeuf en lani√®res", "quantite": 500, "unite": "g"}, {"nom": "Tortillas", "quantite": 8, "unite": "pi√®ces"}, {"nom": "Poivrons", "quantite": 3, "unite": "pi√®ces"}] },
  { "id": 23, "nom": "One Pot Pasta Boeuf et Courgettes", "tags": ["boeuf", "vert", "pates"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "P√¢tes", "quantite": 350, "unite": "g"}, {"nom": "Boeuf hach√©", "quantite": 400, "unite": "g"}, {"nom": "Courgettes", "quantite": 2, "unite": "pi√®ces"}] },
  { "id": 24, "nom": "Saut√© de Porc au Curry et Riz", "tags": ["porc", "epice", "riz"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Porc en d√©s", "quantite": 600, "unite": "g"}, {"nom": "Riz basmati", "quantite": 250, "unite": "g"}, {"nom": "Lait de coco", "quantite": 200, "unite": "ml"}] },
  { "id": 25, "nom": "Po√™l√©e de Gnocchis, Boeuf et Epinards", "tags": ["boeuf", "vert", "gnocchi"], "nb_personnes_base": 4, "lien": "", "ingredients": [{"nom": "Gnocchis", "quantite": 500, "unite": "g"}, {"nom": "Boeuf hach√©", "quantite": 400, "unite": "g"}, {"nom": "Epinards frais", "quantite": 200, "unite": "g"}] }
];

    const KID_RATIO = 0.5;

    function generateMenu() {
        let days = parseInt(document.getElementById('daysCount').value) || 5;
        const adults = parseInt(document.getElementById('nbAdults').value) || 0;
        const kids = parseInt(document.getElementById('nbKids').value) || 0;
        const totalParts = adults + (kids * KID_RATIO);

        days = Math.min(days, recipesDB.length);
        const shuffled = [...recipesDB].sort(() => 0.5 - Math.random());
        const selectedMenu = shuffled.slice(0, days);
        
        displayMenu(selectedMenu, totalParts);
        calculateShopping(selectedMenu, totalParts);
        document.getElementById('resultArea').classList.remove('hidden');
    }

    function displayMenu(menu, totalParts) {
        let html = "<ul>";
        window.currentMenuText = "";
        
        menu.forEach((recipe, i) => {
            const ratio = totalParts / recipe.nb_personnes_base;
            const lien = recipe.lien ? ` <a href="${recipe.lien}" target="_blank">üìñ Voir la recette</a>` : "";
            
            html += `<li><strong>J${i+1}: ${recipe.nom}</strong> ${lien}<ul class="recipe-details">`;
            window.currentMenuText += `J${i+1}: ${recipe.nom}\n`;

            recipe.ingredients.forEach(ing => {
                const qty = (ing.quantite * ratio).toFixed(ing.unite === 'pi√®ces' || ing.unite === 't√™te' ? 1 : 0);
                const line = `${qty} ${ing.unite} de ${ing.nom}`;
                html += `<li>${line}</li>`;
                window.currentMenuText += `  - ${line}\n`;
            });
            html += `</ul></li>`;
        });
        document.getElementById('menuOutput').innerHTML = html + "</ul>";
    }

    function calculateShopping(menu, totalParts) {
        let map = {};
        menu.forEach(recipe => {
            const ratio = totalParts / recipe.nb_personnes_base;
            recipe.ingredients.forEach(ing => {
                let key = ing.nom.toLowerCase().trim() + "_" + ing.unite;
                if (!map[key]) map[key] = { name: ing.nom, qty: 0, unit: ing.unite };
                map[key].qty += (ing.quantite * ratio);
            });
        });

        let html = "<ul>";
        window.currentShoppingText = "";
        Object.values(map).sort((a,b) => a.name.localeCompare(b.name)).forEach(item => {
            let qty = ['g','ml'].includes(item.unit.toLowerCase()) ? Math.ceil(item.qty) : item.qty.toFixed(1);
            let line = `${item.name}: ${qty} ${item.unit}`;
            html += `<li>${line}</li>`;
            window.currentShoppingText += `- [ ] ${line}\n`;
        });
        document.getElementById('shoppingListOutput').innerHTML = html + "</ul>";
    }

    async function exportToNotes() {
        const text = `üçé MON BATCH COOKING\n\nMENU :\n${window.currentMenuText}\nCOURSES :\n${window.currentShoppingText}`;
        if (navigator.share) {
            try { await navigator.share({ title: "Mon Batch Cooking", text: text }); } catch (e) {}
        } else {
            navigator.clipboard.writeText(text);
            alert("Copi√© dans le presse-papier !");
        }
    }
</script>
</body>
</html>
