<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon Batch Cooking</title>
    <style>
        :root { --primary: #10b981; --bg: #f3f4f6; --card: #ffffff; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: var(--bg); color: #333; margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; color: #064e3b; font-size: 1.5rem; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9rem;}
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        .input-group div { flex: 1; }
        input { width: 100%; padding: 10px; box-sizing: border-box; border: 1px solid #ddd; border-radius: 8px; font-size: 1rem;}
        button { background: var(--primary); color: white; border: none; padding: 12px 20px; border-radius: 8px; font-size: 1rem; cursor: pointer; width: 100%; font-weight: bold; margin-top: 10px; }
        .hidden { display: none; }
        .recipe-details { font-size: 0.85rem; color: #666; margin-top: 5px; list-style-type: circle; padding-left: 15px; }
        ul { padding-left: 20px; }
        li { margin-bottom: 10px; }
        a { color: var(--primary); text-decoration: none; font-weight: 500; }
    </style>
</head>
<body>

<div class="container">
    <h1>ü•ó Batch Cooking & Diet</h1>
    
    <div class="card">
        <h3>1. Ma Famille</h3>
        <div class="input-group">
            <div>
                <label>Adultes</label>
                <input type="number" id="nbAdults" value="2" min="1">
            </div>
            <div>
                <label>Enfants</label>
                <input type="number" id="nbKids" value="2" min="0">
            </div>
        </div>
        <label>Jours de menus :</label>
        <input type="number" id="daysCount" value="5" min="1" max="7">
        <button onclick="generateMenu()">G√©n√©rer ma semaine</button>
    </div>

    <div id="resultArea" class="hidden">
        <div class="card">
            <h3>üìÖ Menu & Recettes</h3>
            <div id="menuOutput"></div>
        </div>
        <div class="card">
            <h3>üõí Liste de courses (Global)</h3>
            <div id="shoppingListOutput"></div>
        </div>
        <div style="text-align: center; margin-top: 20px;">
            <button onclick="exportToNotes()">üì§ Exporter vers Notes</button>
        </div>
    </div>
</div>

<script>
    const recipesDB = [
        { "id": 1, "nom": "Bolognaise de B≈ìuf 5% (L√©gumes cach√©s)", "lien": "https://www.750g.com/sauce-bolognaise-rapide-aux-legumes-r204481.htm", "nb_personnes_base": 4, "ingredients": [{"nom": "Boeuf hach√© 5%", "quantite": 500, "unite": "g"}, {"nom": "Spaghetti complets", "quantite": 400, "unite": "g"}, {"nom": "Carottes", "quantite": 3, "unite": "pi√®ces"}, {"nom": "Coulis de tomate", "quantite": 500, "unite": "ml"}] },
        { "id": 2, "nom": "Dahl de Lentilles Corail", "lien": "https://www.750g.com/dhal-de-lentilles-corail-au-lait-de-coco-r204368.htm", "nb_personnes_base": 4, "ingredients": [{"nom": "Lentilles corail", "quantite": 300, "unite": "g"}, {"nom": "Lait de coco light", "quantite": 400, "unite": "ml"}, {"nom": "Riz basmati", "quantite": 250, "unite": "g"}] },
        { "id": 3, "nom": "Frittata Brocolis & Pommes de terre", "lien": "https://www.750g.com/frittata-aux-brocolis-r100025.htm", "nb_personnes_base": 4, "ingredients": [{"nom": "Oeufs", "quantite": 8, "unite": "pi√®ces"}, {"nom": "Pommes de terre", "quantite": 500, "unite": "g"}, {"nom": "Brocolis", "quantite": 1, "unite": "t√™te"}] },
        { "id": 6, "nom": "Lasagnes Bolognaise et Carottes", "lien": "https://www.750g.com/lasagnes-a-la-bolognaise-r204556.htm", "nb_personnes_base": 4, "ingredients": [{"nom": "Boeuf hach√© 5%", "quantite": 500, "unite": "g"}, {"nom": "P√¢tes √† lasagnes", "quantite": 250, "unite": "g"}, {"nom": "Carottes", "quantite": 4, "unite": "pi√®ces"}, {"nom": "Coulis de tomate", "quantite": 600, "unite": "ml"}] },
        { "id": 7, "nom": "Boulettes de Boeuf sauce Tomate", "lien": "https://www.750g.com/boulettes-de-viande-a-la-sauce-tomate-r100483.htm", "nb_personnes_base": 4, "ingredients": [{"nom": "Boeuf hach√© 5%", "quantite": 600, "unite": "g"}, {"nom": "Mozzarella r√¢p√©e", "quantite": 100, "unite": "g"}, {"nom": "Pur√©e de tomate", "quantite": 400, "unite": "ml"}] },
        { "id": 8, "nom": "Gratin de P√¢tes au Jambon & Brocolis", "lien": "https://www.750g.com/gratin-de-pates-au-jambon-et-aux-brocolis-r200056.htm", "nb_personnes_base": 4, "ingredients": [{"nom": "P√¢tes compl√®tes", "quantite": 400, "unite": "g"}, {"nom": "D√©s de jambon", "quantite": 200, "unite": "g"}, {"nom": "Brocolis", "quantite": 600, "unite": "g"}] }
        // ... ajoutez les autres ici sur le m√™me mod√®le
    ];

    const KID_RATIO = 0.5;

    function generateMenu() {
        let days = parseInt(document.getElementById('daysCount').value) || 5;
        const adults = parseInt(document.getElementById('nbAdults').value) || 0;
        const kids = parseInt(document.getElementById('nbKids').value) || 0;
        const totalParts = adults + (kids * KID_RATIO);

        days = Math.min(days, recipesDB.length);
        const shuffled = [...recipesDB].sort(() => 0.5 - Math.random());
        const selectedMenu = shuffled.slice(0, days);
        
        displayMenu(selectedMenu, totalParts);
        calculateShopping(selectedMenu, totalParts);
        document.getElementById('resultArea').classList.remove('hidden');
    }

    function displayMenu(menu, totalParts) {
        let html = "<ul>";
        window.currentMenuText = "";
        
        menu.forEach((recipe, i) => {
            const ratio = totalParts / recipe.nb_personnes_base;
            const lien = recipe.lien ? ` <a href="${recipe.lien}" target="_blank">üìñ Voir la recette</a>` : "";
            
            html += `<li><strong>J${i+1}: ${recipe.nom}</strong> ${lien}<ul class="recipe-details">`;
            window.currentMenuText += `J${i+1}: ${recipe.nom}\n`;

            recipe.ingredients.forEach(ing => {
                const qty = (ing.quantite * ratio).toFixed(ing.unite === 'pi√®ces' || ing.unite === 't√™te' ? 1 : 0);
                const line = `${qty} ${ing.unite} de ${ing.nom}`;
                html += `<li>${line}</li>`;
                window.currentMenuText += `  - ${line}\n`;
            });
            html += `</ul></li>`;
        });
        document.getElementById('menuOutput').innerHTML = html + "</ul>";
    }

    function calculateShopping(menu, totalParts) {
        let map = {};
        menu.forEach(recipe => {
            const ratio = totalParts / recipe.nb_personnes_base;
            recipe.ingredients.forEach(ing => {
                let key = ing.nom.toLowerCase().trim() + "_" + ing.unite;
                if (!map[key]) map[key] = { name: ing.nom, qty: 0, unit: ing.unite };
                map[key].qty += (ing.quantite * ratio);
            });
        });

        let html = "<ul>";
        window.currentShoppingText = "";
        Object.values(map).sort((a,b) => a.name.localeCompare(b.name)).forEach(item => {
            let qty = ['g','ml'].includes(item.unit.toLowerCase()) ? Math.ceil(item.qty) : item.qty.toFixed(1);
            let line = `${item.name}: ${qty} ${item.unit}`;
            html += `<li>${line}</li>`;
            window.currentShoppingText += `- [ ] ${line}\n`;
        });
        document.getElementById('shoppingListOutput').innerHTML = html + "</ul>";
    }

    async function exportToNotes() {
        const text = `üçé MON BATCH COOKING\n\nMENU :\n${window.currentMenuText}\nCOURSES :\n${window.currentShoppingText}`;
        if (navigator.share) {
            try { await navigator.share({ title: "Mon Batch Cooking", text: text }); } catch (e) {}
        } else {
            navigator.clipboard.writeText(text);
            alert("Copi√© dans le presse-papier !");
        }
    }
</script>
</body>
</html>
